---
title: "FlaskアプリにAuth0つけようとしたらapp.pyがぶっ壊れた話"
emoji: "⭐"
type: "tech"
topics: ["Auth0", "Python", "Flask"]
published: false
---

>Flaskは1ファイルで済むって言ったやつ出てこい

### 0. はじめに
本番環境に公開するためにAuth0入れてみたけどapp.pyが肥大化して詰んだ。
当初はAuth0をapp.pyに直接投入していたが、ルーティングぐちゃぐちゃになってページが開けなくなったので泣く泣く分割。
ハマった知見とかも共有しときます。

### 1. 初期状態：フル装備`app.py`の地獄

* ファイルサイズ・ルートの数・Authのロジック混在
* これを直さないとつらい例（認証ルートがPDFルートと隣にある罪）

```python
@app.route("/generate_pdf")
def pdf(): ...
@app.route("/login")
def login(): ...
```

### 2. 目標：**「構成と認証をちゃんと分離」**

* `create_app()`を導入してFlaskアプリを工場生産
* `routes.py`, `auth.py`, `db.py` に分割
* `.env`活用、セキュアな環境変数管理

図解あると神（「Before: app.pyに全部詰まってる」「After: モジュールで分割」）



### 3. Auth0導入：そこそこ痛いけどやる価値あり

* Flask + Auth0 の実装で詰まるポイント（callback地獄、セッション管理）
* `@requires_auth` デコレータの意味と使い所
* 認証ルートは **auth.pyに分離すべし** の哲学



### 4. 構成後の構成（爆発後に残った美しい世界）

* `run.py` から `create_app()` 呼び出し
* `Blueprint` は導入してないけど、その布石にはなってる話
* セッション管理で delivery\_list のグローバル脱却もサラッと紹介（ここ読者刺さる）



### 5. おわりに
最終的にAuth0取付できて、次回予定の本番環境構築準備ができた。

* app.pyがでかくなるのは誰にでも起きる
* でも、**構成を見直すタイミングとやり方を知ってるかどうかが違いになる**



* Flaskは気軽に始められるぶん、「構成」や「認証まわり」で死ぬ初心者が多い
* `create_app()`とAuth0で「実用的なFlaskアプリ」にグレードアップできる
* 小さなアプリでも、**構成を分けて育てると再利用できる技術になる**

