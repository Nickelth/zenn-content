---
title: "セキュリティ戦略"
emoji: "⚛️"
type: "tech"
topics: ["WireGuard"]
published: false
---
WireGuardのVPNに接続したPCから、VPNサーバ上で動作するリモートデスクトップにアクセスするための手順を説明します。これには、まずVPNサーバにリモートデスクトップサービスをセットアップし、その後、クライアントPCからリモートデスクトップ接続を行う手順が含まれます。

### 1. Ubuntuサーバ上にリモートデスクトップをインストールする

Ubuntuサーバでリモートデスクトップサービスを設定するには、以下の手順に従います。

#### **a. デスクトップ環境のインストール**
リモートデスクトップを使用するためには、最小限のデスクトップ環境をインストールする必要があります。ここでは、軽量なデスクトップ環境として`Xfce`をインストールします。

```bash
sudo apt update
sudo apt install xfce4 xfce4-goodies
```

#### **b. xrdpのインストール**
次に、リモートデスクトッププロトコル（RDP）をサポートする`xrdp`をインストールします。

```bash
sudo apt install xrdp
```

#### **c. xrdpの設定**
`xrdp`をインストールしたら、`xrdp`をXfceと連携させます。

```bash
echo xfce4-session >~/.xsession
sudo systemctl restart xrdp
```

#### **d. ファイアウォールの設定**
`xrdp`は標準でポート3389を使用します。このポートへのアクセスを許可する必要がありますが、WireGuard経由でのみアクセスを許可するようにします。

```bash
sudo ufw allow from 10.0.0.0/24 to any port 3389
sudo ufw enable
```

`10.0.0.0/24`はWireGuardのVPNクライアントのネットワークアドレスです。適切に設定してください。

### 2. WireGuard VPNサーバに接続する

クライアントPCで、先ほど作成したWireGuardの設定ファイル（`client.conf`）を使用してVPNに接続します。

#### **a. WireGuardクライアントのインストール**
クライアントPCにWireGuardクライアントをインストールし、設定ファイルをインポートして接続します。これは以前に示した手順と同様です。

#### **b. VPN接続の確認**
接続後、クライアントPCがWireGuard経由でVPNサーバに接続されていることを確認します。`ip a`コマンドでWireGuardインターフェイスのIPアドレスが正しく割り当てられているか確認します。

### 3. クライアントPCからリモートデスクトップ接続を行う

#### **a. Windows PCの場合**
1. **リモートデスクトップ接続の起動**:
   - Windowsの検索バーで「リモートデスクトップ接続」と入力し、アプリを起動します。

2. **サーバのIPアドレスを入力**:
   - `コンピューター`フィールドに、VPNサーバのVPN内のIPアドレス（例: 10.0.0.1）を入力します。
   - 「接続」ボタンをクリックします。

3. **資格情報の入力**:
   - サーバ上のユーザー名とパスワードを入力します。初回接続時には、証明書の警告が表示される場合がありますが、「続行」を選択して接続を確立します。

#### **b. Linux PCの場合**
1. **Remminaのインストール**:
   - Remminaは、Linuxでリモートデスクトップ接続を行うためのクライアントです。以下のコマンドでインストールします。
   
   ```bash
   sudo apt install remmina
   ```

2. **リモートデスクトップ接続の設定**:
   - Remminaを起動し、「新しい接続」を作成します。
   - プロトコルに「RDP - リモートデスクトッププロトコル」を選択し、サーバのVPN内のIPアドレス（例: 10.0.0.1）を指定します。
   - 必要なユーザー名とパスワードを入力し、接続をクリックします。

### 4. セキュリティ強化のための追加設定

- **SSHトンネリングの利用**: 追加のセキュリティ層として、リモートデスクトップのトラフィックをSSHトンネル経由で送信することもできます。
- **ファイアウォール制限**: RDPへのアクセスをVPN接続に限定することで、より安全なリモート接続を維持します。
- **リモートデスクトップの制限**: リモートデスクトップへのアクセスを必要なユーザーにのみ許可するために、リモートデスクトップ接続の設定をカスタマイズします。

これで、WireGuard VPNに接続したPCから、VPNサーバ上で動作するリモートデスクトップにアクセスできるようになります。この設定により、安全かつ効率的にサーバをリモート管理することが可能です。