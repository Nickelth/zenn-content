---
title: "Windowsバッチサーバー運用保守PJ"
---

## Windowsバッチサーバー運用保守PJ

### 概要

#### ドメイン

人事・総務系の社内業務システム（勤怠・経費・資格情報・ヘルスケア等）の定期更新を行うバッチサーバー。

#### 目的

- 前担当者からの運用保守業務の引継ぎと、安定運用の継続
- 人事異動に伴うメール通知先・各種管理権限の正確な更新
- PHP・OS・ライブラリ等のバージョン陳腐化に対する計画的なバージョンアップ
- 障害・バグ発生時の原因調査と恒久対応による運用リスクの低減

#### 構成

WIndowsサーバー + タスクスケジューラー + バッチスクリプト + PowerShell + Ruby + CSVファイル

### 案件情報

期間：2024/12 〜 現在  

体制：PM 1名、SE 1〜3名からなる 2〜4名の受託開発チーム。  

役割：Windowsバッチ・Powershellの改修・調査・日次運用、障害対応など運用保守全般を担当。
    ※Rubyは保守契約の対象外

### 担当業務

- タスクスケジューラ定期実行内容の監視
- サーバーメンテナンス期間前後のタスクスケジューラー登録タスクの停止/再開
- バッチスクリプト失敗時の一次切り分け・復旧対応

### 技術スタック

**言語・ライブラリ:** Windowsバッチ, Powershell 

**OS:** Windows Server

**ツール:** VSCode, タスクスケジューラー, Windows Virtual Desktop

### Key ADR

#### ADR-01: 必ず失敗する定期ジョブの原因調査・不具合解消

##### 背景

他システムと正常にファイル連携ができていなかった結果、定期ジョブが失敗していた。

##### 評価軸

##### 採否

##### 却下理由

#### ADR-02: 

##### 背景

##### 評価軸

##### 採否

##### 却下理由

### 振り返り

#### 技術的な学び

#### プロセス・コミュニケーションの学び

#### 現状


### 抄録（150–200字）

定期ジョブのタイミング依存失敗を、**“1回限り再実行”＋再帰防止＋冪等性**で無害化。管理者権限とタスクスケジューラ利用を前提に、最小変更で運用負荷とアラートを抑制した設計の記録。

### TL;DR

* 目的: 失敗の無害化と運用手順ゼロ化
* 決定: 失敗時のみ+6分で一度だけ再実行、再帰防止フラグ
* 理由: +5/+10分タスクと衝突せず最短スロットが6分
* 成果: 深夜帯失敗“影響”ゼロ、再実行は可視化のみ

### スコープ/非スコープ

* スコープ: 定期ジョブの再実行設計、排他、冪等、観測
* 非スコープ: 上流の生成時刻変更、アプリ本体改修

### 使用技術・環境

* Windows タスクスケジューラ、バッチ/PowerShell、ログ収集基盤（任意）

### 構成図（1枚）

* 「上流生成→バッチ→再実行トリガ→6分スロット→完了」だけ示す

### Decision Log

| テーマ   | 代替案              | 評価軸         | 採用     | 捨てた理由      |
| ----- | ---------------- | ----------- | ------ | ---------- |
| 再実行方式 | 手動/全日次再実行/失敗のみ一度 | 影響範囲/工数/SLO | 失敗のみ一度 | 重複・副作用/運用増 |
| スロット  | +5/+6/+10        | 非競合/回復速度    | +6     | +5衝突、+10遅い |
| 観測    | まとめログ/イベント分離     | 調査性/静穏      | 分離     | 失敗原因が埋もれる  |

### 設計の要点

* 遅延再実行は+6分固定（根拠は直後+5/+10の衝突回避）
* 再帰防止フラグで“1回限り”を保証
* 冪等化（テンポラリ→原子置換、既取得スキップ）
* 排他（多重起動禁止設定）
* 観測（失敗/予約/再実行成功を別イベント）

### リスクと緩和

* 将来のスケジュール変更で衝突 → 遅延は設定値化、変更時レビュー必須
* 上流遅延が6分超 → 月次で再実行件数を監視し閾値超で再調整

### 今後の改善

* 生成完了イベント化、メトリクスダッシュボード化

---

## 仕上げミニチェックリスト（全記事共通）

* [ ] 抄録200字内、TL;DR 4行以内
* [ ] 図1枚、表1枚、Decision Log表あり
* [ ] スコープ/非スコープ明記
* [ ] 「採用しなかった理由」を必ず1つ以上
* [ ] 個人情報・機密ゼロ、実務名は匿名化

この型で、再現実験ゼロでも“判断と構成”で押し切れる。時間が足りないなら、図は四角と矢印だけにして出す。文章は短く、決定と理由は濃く。