---
title: "MLOps Sci-kit Learn 全体概要"
---

Executive 1-pager: 成果と価値（1p）

何を作ったか：scikit-learn → 成果物 → 推論API → コンテナ → ECS/ALB の最短導線

結果要約：ALB /healthz 常時200、手動デプロイ可、ロールバック実演、構造化ログ、アラーム最小3種

再現コマンドのワンパス：make init → make train-full → docker-run → curl /health、ECS版の一行要約

図：全体アーキ図（VPC/ALB/TG/ECS/ECR/S3/CloudWatch）

---

# 総評（いまの案の強み・弱み）

* 強み

  * CI 3本と Terraform 階層は読み手が追いやすい。
  * ADR を入れているのは採用サイドに刺さる（判断能力のエビデンスになる）。

* 弱み

  * 1ページ目が「概要」だけだと、**価値・結果・証跡**が伝わりにくい。
  * 運用視点（SLO/アラーム/ロールバック/コスト）と**負荷試験の結果要約**が独立していない。
  * 「再現手順」のワンパス（clone→make→デプロイ→確認）を先に提示していない。

---

# 推奨：Zenn Book 章立て（採用担当向け最適化）

読みやすさ優先で**12〜16ページ**想定。各章は「結論先出し → 図/表 → 補足」の順に。

1. **Executive 1-pager: 成果と価値**（1p）

   * 何を作ったか：scikit-learn → 成果物 → 推論API → コンテナ → ECS/ALB の最短導線
   * **結果要約**：ALB `/healthz` 常時200、手動デプロイ可、ロールバック実演、構造化ログ、アラーム最小3種
   * **再現コマンドのワンパス**：`make init → make train-full → docker-run → curl /health`、ECS版の一行要約
   * 図：全体アーキ図（VPC/ALB/TG/ECS/ECR/S3/CloudWatch）

2. **アーキテクチャ概要と設計原則**（1p）

   * 原則：最小構成、IaC薄切り、再現性、観測可能性、ロールバック優先
   * 非採用：latest不使用、過度なマネージドML不採用の理由（表形式×scikit-learnの割り切り）

3. **運用SLOと観測（CloudWatch）**（1–2p）

   * SLO候補：可用性/レイテンシ（p95）、エラー率
   * 監視：構造化ログ1行JSON、メトリクスと**具体しきい値**、誤検知対策メモ
   * **アラーム3種**：5xx率、TargetResponseTime、タスク異常終了

4. **リリース戦略とロールバック実演**（1–2p）

   * 手動デプロイ手順（TaskDef登録→force-new→前リビジョンに戻す）
   * **証跡リンク**：*_ecs_force_new_success.txt / *_ecs_rollback_to_prev.txt
   * 失敗パターンの原因と復旧所要時間の実測

5. **CI 3本まとめ（役割別）**（3p想定）

   * 5-1. **ci.yml（ユニット/静的解析/最小E2E）**

     * 失敗例テンプレ: OIDC AssumeRole 失敗の再発防止
   * 5-2. **release-ecr.yml（ビルド/タグ/ダイジェスト公開）**

     * **Digest固定の理由**と参照方法
   * 5-3. **push-s3.yml（モデル/成果物の公開）**

     * S3 `latest/` と snapshot の両立方針（整合チェック）

6. **Terraform 最小構成（モジュール別）**（3–4p）

   * 6-1. **infra 直下方針**：state分離、命名規約、Importは完全一致狙わないポリシ
   * 6-2. **00-Network**：VPC/サブネット/SG。図は最小限
   * 6-3. **20-ecr**：リポジトリ方針、イミュータブル運用
   * 6-4. **30-ecs-alb-mlops**：サービス、ターゲットグループ、リスナー、ヘルスチェック

7. **APIとパフォーマンス要点**（1–2p）

   * エンドポイント（/health, /schema, /predict, /predict_batch, /reload）
   * **workers=1/2 のRPSとp95比較（短評）**
   * `/reload` の切替所要時間（ms）
   * 将来拡張（閾値`artifacts/threshold.json`の参照切替）

8. **モデル学習の実験と成果物**（1p）

   * データセット、AUCベースライン、Permutation Importanceの活用
   * 成果物の保存先と検証方法

9. **負荷試験（k6）要約**（1p）

   * シナリオ2本：短時間ピークと低RPS継続
   * **掲載は要約表**のみ（RPS/p90/p95/エラー率）。詳細は`docs/evidence/*.json`リンク

10. **セキュリティと権限の最小化**（1p）

    * OIDC + AssumeRole、最小ポリシの考え方（具体文面は割愛、設計原則のみ）
    * ECR/S3 への限定権限、ログ可視化範囲

11. **コスト見積り（試算レンジ）**（1p）

    * 低負荷運用の概算、スケール方針、削減余地（オートスケール閾値）

12. **ADR 抜粋（3〜5本）**（合計1–2p）

    * タイトルと「決定/理由/却下案/影響」の要約だけを並べる
    * 本文は `docs/adr/` へリンク

13. **再現手順（ワンページ）**（1p）

    * ローカルとECSの2パスのみ。**コマンドは最短**に限定
    * 失敗時FAQのリンク

14. **Appendix：証跡索引**（1p）

    * `docs/evidence/` のファイル名規約と、代表3点の直リンク

---

# 章ごとの「入れるべき具体物」

* 図：全体アーキ、ECS/ALB関連の最小2枚
* 表：SLO/アラーム要約表、k6結果サマリ表、workers差分表
* クリップ：`curl -I https://{alb}/healthz` の最終成功ログ1件だけ
* リンク：CHANGELOG、証跡一式、Terraform plan 抜粋、CloudTrail/Configクエリ

---

# CI 3本のページで必ず触れる短文（採用向けフック）

* 「このCIが守っている品質境界」
* 「失敗例と恒久対策」
* 「最短で証跡を確認する方法（バッジ/Artifacts/Logsの導線）」
* 「Digest固定による再現性とロールバック容易性」

---

# Terraform 章の評価ポイント化（チェックリスト）

* [ ] state 分離方針（env別 or layer別）
* [ ] 命名規約1ページ（プレフィックス、タグ戦略）
* [ ] セキュリティグループの意図（最小受け口とヘルスチェック）
* [ ] ALB ヘルスチェック値（パス、Interval、Threshold）
* [ ] ECS タスクの resource 要件と予備ヘッドルーム
* [ ] ECR ライフサイクル（タグ/ダイジェスト運用）

---

# ADR 候補（タイトル案だけ並べて本文は docs へ）

1. **ADR-001: ML 推論を scikit-learn + FastAPI + ECS に固定した理由**
2. **ADR-002: イメージ参照を latest 禁止・ダイジェスト固定にした理由**
3. **ADR-003: IaC を Terraform “薄切り”に留めた理由（Import完全一致は狙わない）**
4. **ADR-004: 観測は CloudWatch Logs JSON 単一行＋最小アラーム3種から開始**
5. **ADR-005: S3 `latest/` と snapshot 併用運用の整合性担保**
6. **ADR-006: 手動デプロイとロールバックを優先した運用設計（Blue/Greenは不採用）**
7. **ADR-007: k6 による最小負荷試験の適用範囲と非目標（本番性能保証はしない）**

---

# 採用側に刺さる“短い定型文”サンプル（そのまま流用可）

* **再現性**: 「Digest固定と S3 snapshot により、任意時点のコンテナとモデルを確定参照して再現できます。」
* **回復性**: 「手動デプロイ手順を標準化し、直前リビジョンへのロールバックは3分以内に完了しました。」
* **観測可能性**: 「1行JSONログと3種アラームにより、障害の検知と一次切り分けをリモート単独で実施可能です。」
* **スコープ管理**: 「最短導線の維持と検証容易性を優先し、外部サービス統合は採用しませんでした。」

---

# 最後に：いまの構成をこう直せばOK

* ①PJ概要(1p) → **Executive 1-pager**に昇格（成果/SLO/再現ワンパスを入れる）
* ②CI3本=3p → そのまま、ただし各ページに「品質境界/失敗例/証跡導線」を必ず入れる
* ③Terraform（4階層）=3–4p → 「infra方針」を先頭に置いてからモジュール説明
* ④ADR複数本 → タイトル列挙＋結論要約、本文は `docs/adr/` へリンク
* 追加：**リリース/ロールバック** 1p、**運用SLO/観測** 1–2p、**負荷試験要約** 1p、**再現手順** 1p、**Appendix: 証跡索引** 1p

これで「実務で回せるか」を短時間で判断できる本になる。技術自慢はうまく隠して、**結果と意思決定**だけ前に出す。採用側は長い手記を読む暇なんてない。君の本は読むけどね、短いなら。
