---
title: "IaC: RDS 薄切り（infra/10-rds）"
---

### RDS 用 Terraform モジュール（infra/10-rds）

Papyrus アプリケーションが利用する PostgreSQL を、Terraform で管理するためのモジュールである。  
役割は、**ECS Fargate からプライベートな RDS インスタンスに接続するための最低限の土台を用意すること**に限定している。

#### 管理しているリソース

このモジュールで Terraform 管理しているのは、RDS 周辺の以下のリソース群である。

- DB インスタンス  
  - エンジン: PostgreSQL 16  
  - 小規模な汎用インスタンスクラス  
  - ストレージは 20GB、暗号化を有効化  
  - プライベートサブネットにのみ配置し、パブリックアクセスは無効  
  - 自動バックアップは 1 日分だけ保持  
  - 削除保護は無効、最終スナップショットも取得しない  
  - パラメータ変更を即時反映する設定にしている  

- DB サブネットグループ  
  - VPC 内のプライベートサブネット ID の一覧を入力として受け取り、RDS 用のサブネットグループを作成する。

- RDS 用セキュリティグループ  
  - RDS 側のセキュリティグループを専用に 1 つ作成する。  
  - インバウンドは 5432/TCP のみ許可し、送信元は ECS タスク用セキュリティグループに限定する。  
  - 任意の CIDR からのアクセスは許可しない構成である。

- パラメータグループ  
  - PostgreSQL 16 向けのパラメータグループを作成し、クエリ時間や接続に関するログ設定だけを上書きしている。  
  - 性能チューニングではなく、「必要なログを残せる状態」にすることを目的とした最小構成になっている。

- タグ  
  - Project / Env / Owner といったタグをローカル変数で共通化し、上記の各リソースに付与している。

#### 入力パラメータの考え方

モジュールが外部から受け取る主なパラメータは次の通りである。

- VPC ID  
- プライベートサブネット ID のリスト  
- ECS タスク用セキュリティグループ ID  
- DB ユーザー名 / パスワード  
- リソース名のプレフィックス（`name_prefix`）

ネットワーク構成や ECS 側のセキュリティグループは上位のモジュールが管理し、  
このモジュールは「RDS インスタンス本体と、その直近の周辺コンポーネント」だけを責務として持つ構成になっている。

#### 設計上のポイント

- RDS は常にプライベートサブネットに配置し、  
  セキュリティグループのルールも「ECS タスク用 SG → RDS 用 SG の 5432/TCP」に限定している。  
  これにより、RDS へは ECS 経由でしか到達しない前提を明示している。

- 暗号化とバックアップは有効にしつつ、インスタンス種別や保持期間は開発・検証向けの設定にしている。  
  削除時の保護を有効化していないため、学習・検証用途で作り直しがしやすい構成であることが分かる。

- パラメータグループは、まずログ関連だけを Terraform で管理し、  
  詳細なチューニングは後から追加できるようにしている。  
  これにより、「ログは必ず残るが、性能調整にはまだロックをかけない」というバランスにしている。

- いずれのリソースも共通タグを付与し、プロジェクト単位・環境単位での管理やコスト集計ができるようにしている。